<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Doc Portal Launcher</title>
  <link rel="icon" href="https://docs.reltio.com/favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220;
      --panel:#101a33;
      --text:#e7ecff;
      --muted:#aab3d6;
      --accent:#6ee7ff;
      --border:rgba(255,255,255,.12);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Libre Franklin",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, #14234a 0%, var(--bg) 55%),
                  radial-gradient(900px 700px at 90% 10%, #0c4a6e 0%, rgba(11,18,32,0) 55%);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px}
    header{
      background: rgba(16,26,51,.72);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      backdrop-filter: blur(10px);
    }
    h1{margin:0 0 6px;font-size:20px;font-weight:600;letter-spacing:.2px}
    p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}

    .card{
      margin-top:14px;
      background: rgba(16,26,51,.55);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
    }

    .modeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .modeBtn{
      flex:1;
      min-width: 220px;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--text);
      cursor:pointer;
      font-weight:700;
      text-align:center;
    }
    .modeBtn.active{
      border-color: rgba(110,231,255,.75);
      background: linear-gradient(135deg, rgba(110,231,255,.22), rgba(110,231,255,.06));
    }

    .row{display:grid;grid-template-columns:1fr;gap:12px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    input, select, button{
      width:100%;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    button.primary{
      cursor:pointer;
      font-weight:800;
      border-color: rgba(110,231,255,.55);
      background: linear-gradient(135deg, rgba(110,231,255,.22), rgba(110,231,255,.06));
    }
    button.primary:hover{border-color: rgba(110,231,255,.9)}
    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .hint code{
      color:var(--text);
      background: rgba(0,0,0,.25);
      padding:2px 6px;
      border-radius: 8px;
      border:1px solid rgba(255,255,255,.10);
    }
    .status{
      margin-top:10px;
      font-size:12px;
      color: var(--muted);
      min-height: 18px;
    }

    .hidden{display:none !important}

    @media (max-width: 820px){
      .row2{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Doc Portal Launcher</h1>
      <p>Choose what you want to do: compare two environments side-by-side, or open a single environment (same path).</p>
    </header>

    <div class="card">
      <div class="modeRow">
        <div id="modeCompare" class="modeBtn active" role="button" tabindex="0">Compare environments</div>
        <div id="modeOpen" class="modeBtn" role="button" tabindex="0">Open a specific environment</div>
      </div>

      <div class="row">
        <input id="urlInput" placeholder="Paste full docs URL (PROD / STAGING / UAT)..." />

        <!-- Compare UI -->
        <div id="compareUI" class="row2">
          <select id="leftEnv" aria-label="Left environment"></select>
          <select id="rightEnv" aria-label="Right environment"></select>
        </div>

        <!-- Open single UI -->
        <div id="openUI" class="row2 hidden">
          <select id="singleEnv" aria-label="Environment to open"></select>
          <div></div>
        </div>

        <button id="goBtn" class="primary">Go</button>

        <div class="hint" id="hintCompare">
          Compare opens two reusable pop-up windows side-by-side. Allow pop-ups for <code>luisjguedes.github.io</code> (one-time).
        </div>
        <div class="hint hidden" id="hintOpen">
          Open mode launches a single window/tab in the environment you choose.
        </div>

        <div class="status" id="status"></div>
      </div>
    </div>
  </div>

<script>
  // === Configure environments here ===
  const envMap = {
    PROD:   "https://docs.reltio.com/en",
    STAGING:"https://reltio-staging.portal.heretto.com/en",
    UAT:    "https://reltio-preview.portal.heretto.com/en"
  };

  const envPatterns = {
    PROD:   ["https://docs.reltio.com/en"],
    STAGING:["https://reltio-staging.portal.heretto.com/en","https://docstaging.reltio.com/en"],
    UAT:    ["https://reltio-preview.portal.heretto.com/en"]
  };

  // === Elements ===
  const modeCompare = document.getElementById("modeCompare");
  const modeOpen = document.getElementById("modeOpen");

  const urlInput = document.getElementById("urlInput");
  const compareUI = document.getElementById("compareUI");
  const openUI = document.getElementById("openUI");

  const leftEnv = document.getElementById("leftEnv");
  const rightEnv = document.getElementById("rightEnv");
  const singleEnv = document.getElementById("singleEnv");

  const goBtn = document.getElementById("goBtn");
  const hintCompare = document.getElementById("hintCompare");
  const hintOpen = document.getElementById("hintOpen");
  const statusEl = document.getElementById("status");

  function setStatus(msg){ statusEl.textContent = msg || ""; }

  // === Mode state ===
  let mode = "compare"; // "compare" | "open"

  function setMode(nextMode){
    mode = nextMode;

    modeCompare.classList.toggle("active", mode === "compare");
    modeOpen.classList.toggle("active", mode === "open");

    compareUI.classList.toggle("hidden", mode !== "compare");
    openUI.classList.toggle("hidden", mode !== "open");

    hintCompare.classList.toggle("hidden", mode !== "compare");
    hintOpen.classList.toggle("hidden", mode !== "open");

    goBtn.textContent = (mode === "compare") ? "Compare" : "Open";
    setStatus("");
  }

  modeCompare.addEventListener("click", () => setMode("compare"));
  modeOpen.addEventListener("click", () => setMode("open"));
  modeCompare.addEventListener("keydown", (e)=>{ if(e.key==="Enter") setMode("compare"); });
  modeOpen.addEventListener("keydown", (e)=>{ if(e.key==="Enter") setMode("open"); });

  // Populate env dropdowns
  function fillSelect(sel){
    sel.innerHTML = "";
    Object.keys(envMap).forEach(env => sel.add(new Option(env, env)));
  }
  fillSelect(leftEnv);
  fillSelect(rightEnv);
  fillSelect(singleEnv);

  leftEnv.value = "STAGING";
  rightEnv.value = "PROD";
  singleEnv.value = "PROD";

  function detectPath(inputUrl){
    const url = (inputUrl || "").trim();
    for(const bases of Object.values(envPatterns)){
      for(const base of bases){
        if(url.startsWith(base)){
          return url.slice(base.length) || "/";
        }
      }
    }
    return null;
  }

  function buildUrl(env, path){
    const p = (path || "/").startsWith("/") ? (path || "/") : "/" + (path || "/");
    return envMap[env] + p;
  }

  function openSplit(leftUrl, rightUrl){
    const availLeft = (typeof screen.availLeft === "number") ? screen.availLeft : 0;
    const availTop  = (typeof screen.availTop === "number") ? screen.availTop : 0;

    const w = Math.max(1200, Math.floor(screen.availWidth * 0.98));
    const h = Math.max(700, Math.floor(screen.availHeight * 0.92));
    const half = Math.floor(w / 2);

    const common =
      "popup=yes,noopener,noreferrer,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes";

    const leftFeatures  = `${common},width=${half},height=${h},left=${availLeft},top=${availTop}`;
    const rightFeatures = `${common},width=${w-half},height=${h},left=${availLeft+half},top=${availTop}`;

    const leftWin = window.open(leftUrl, "doc_left", leftFeatures);
    const rightWin = window.open(rightUrl, "doc_right", rightFeatures);

    if(!leftWin || !rightWin){
      setStatus("Pop-ups blocked. Allow pop-ups for this site, then try again.");
      alert("Pop-ups blocked. Allow pop-ups for luisjguedes.github.io, then click Compare again.");
      return false;
    }

    // Retry positioning a few times (some browsers only allow after creation)
    const tries = [0, 120, 350, 700];
    tries.forEach((ms) => {
      setTimeout(() => {
        try { leftWin.moveTo(availLeft, availTop); leftWin.resizeTo(half, h); } catch {}
        try { rightWin.moveTo(availLeft + half, availTop); rightWin.resizeTo(w - half, h); } catch {}
      }, ms);
    });

    setStatus("Opened/updated two reusable windows (doc_left + doc_right).");
    return true;
  }

  function openSingle(url){
    window.open(url, "doc_single", "noopener,noreferrer");
    setStatus("Opened in the selected environment.");
  }

  function getPathOrAlert(){
    const input = urlInput.value.trim();
    const path = detectPath(input);

    if(!path){
      alert("Paste a URL from PROD/STAGING/UAT first (or add more bases to envPatterns).");
      return null;
    }
    return path;
  }

  function persist(mode, path){
    const qp = new URLSearchParams();
    qp.set("mode", mode);
    qp.set("path", path);
    qp.set("left", leftEnv.value);
    qp.set("right", rightEnv.value);
    qp.set("env", singleEnv.value);
    history.replaceState(null, "", "?" + qp.toString());
  }

  goBtn.addEventListener("click", () => {
    const path = getPathOrAlert();
    if(!path) return;

    if(mode === "compare"){
      persist("compare", path);
      openSplit(buildUrl(leftEnv.value, path), buildUrl(rightEnv.value, path));
    } else {
      persist("open", path);
      openSingle(buildUrl(singleEnv.value, path));
    }
  });

  urlInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") goBtn.click();
  });

  // Init from query params
  (function initFromQuery(){
    const qp = new URLSearchParams(location.search);
    const m = qp.get("mode");
    const path = qp.get("path");
    const l = qp.get("left");
    const r = qp.get("right");
    const env = qp.get("env");

    if(l && envMap[l]) leftEnv.value = l;
    if(r && envMap[r]) rightEnv.value = r;
    if(env && envMap[env]) singleEnv.value = env;

    if(m === "open") setMode("open");
    else setMode("compare");

    if(path){
      // Put a representative URL into the input so it feels "loaded"
      const exampleEnv = (m === "open") ? (singleEnv.value || "PROD") : (rightEnv.value || "PROD");
      urlInput.value = buildUrl(exampleEnv, path);
      setStatus("Ready. Click Go.");
    }
  })();
</script>
</body>
</html>
